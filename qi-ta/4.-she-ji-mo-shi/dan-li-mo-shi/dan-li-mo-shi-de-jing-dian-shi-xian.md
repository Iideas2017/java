# 1. 单例模式的经典实现

## **1、单例模式理论基础**

**定义：** 确保一个类只有一个实例，并为整个系统提供一个全局访问点 \(向整个系统提供这个实例\)。

**类型：** 创建型模式

**结构：**

![](../../../.gitbook/assets/image%20%2863%29.png)

特别地，为了更好地理解上面的类图，我们以此为契机，介绍一下类图的几个知识点：

* 类图分为三部分，依次是类名、属性、方法；
* 以&lt;&lt;开头和以&gt;&gt;结尾的为注释信息；
* 修饰符+代表public，-代表private，\#代表protected，什么都没有代表包可见；
* 带下划线的属性或方法代表是静态的。

**三要素：**

* **私有的构造方法；**
* **指向自己实例的私有静态引用；**
* **以自己实例为返回值的静态的公有方法。**

## **2、两种经典实现**

　　在介绍单线程环境中单例模式的两种经典实现之前，我们有必要先解释一下 **立即加载** 和 **延迟加载** 两个概念。

* 立即加载 ： 在类加载初始化的时候就主动创建实例；
* 延迟加载 ： 等到真正使用的时候才去创建实例，不用时不去主动创建。

  　　在单线程环境下，单例模式根据实例化对象时机的不同，有两种经典的实现：一种是 **饿汉式单例\(立即加载\)**，一种是 **懒汉式单例\(延迟加载\)**。饿汉式单例在单例类被加载时候，就实例化一个对象并交给自己的引用；而懒汉式单例只有在真正使用的时候才会实例化一个对象并交给自己的引用。代码示例分别如下：

#### **饿汉式单例：**

```java
// 饿汉式单例
public class Singleton1 {

    // 指向自己实例的私有静态引用，主动创建
    private static Singleton1 singleton1 = new Singleton1();

    // 私有的构造方法
    private Singleton1(){}

    // 以自己实例为返回值的静态的公有方法，静态工厂方法
    public static Singleton1 getSingleton1(){
        return singleton1;
    }
}
```

　　我们知道，**类加载的方式是按需加载，且加载一次。**因此，在上述单例类被加载时，就会实例化一个对象并交给自己的引用，供系统使用；而且，由于这个类在整个生命周期中只会被加载一次，因此只会创建一个实例，即能够充分保证单例。

#### **懒汉式单例：**

```java
// 懒汉式单例
public class Singleton2 {

    // 指向自己实例的私有静态引用
    private static Singleton2 singleton2;

    // 私有的构造方法
    private Singleton2(){}

    // 以自己实例为返回值的静态的公有方法，静态工厂方法
    public static Singleton2 getSingleton2(){
        // 被动创建，在真正需要使用时才去创建
        if (singleton2 == null) {
            singleton2 = new Singleton2();
        }
        return singleton2;
    }
}
```

　　我们从懒汉式单例可以看到，单例实例被延迟加载，即只有在真正使用的时候才会实例化一个对象并交给自己的引用。

　　总之，从速度和反应时间角度来讲，饿汉式（又称立即加载）要好一些；从资源利用效率上说，懒汉式（又称延迟加载）要好一些。

## **3、单例模式的优点**

　　我们从单例模式的定义和实现，可以知道单例模式具有以下几个优点：

* 在内存中**只有一个对象**，节省内存空间；
* 避免频繁的创建销毁对象，可以提高性能；
* **避免对共享资源的多重占用，简化访问**；
* 为整个系统提供一个全局访问点。

## **4、单例模式的使用场景**

　　由于单例模式具有以上优点，并且形式上比较简单，所以是日常开发中用的比较多的一种设计模式，**其核心在于为整个系统提供一个唯一的实例，**其应用场景包括但不仅限于以下几种：

* 有状态的工具类对象；
* 频繁访问数据库或文件的对象；

## **5、单例模式的注意事项**

　　在使用单例模式时，我们必须使用单例类提供的**公有工厂方法**得到**单例对象**，而**不应该使用反射来创建**，**否则将会实例化一个新对象**。此外，在多线程环境下使用单例模式时，应特别注意线程安全问题。

